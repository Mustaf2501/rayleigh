<!DOCTYPE html>
<html>
<head>
  <title>Rayleigh: Search by multiple colors</title>
  <link href="/static/css/main.css" media="all" rel="stylesheet" type="text/css"/>
</head>
<body>
  <div id="content">
    <div id="colors">
      <p>Possible colors:</p>
      <p>
<a id="#ffaaaa"><span style="background-color: #ffaaaa" /></a>
<a id="#ffddaa"><span style="background-color: #ffddaa" /></a>
<a id="#f8ffaa"><span style="background-color: #f8ffaa" /></a>
<a id="#aaffb2"><span style="background-color: #aaffb2" /></a>
<a id="#aaffeb"><span style="background-color: #aaffeb" /></a>
<a id="#aaccff"><span style="background-color: #aaccff" /></a>
<a id="#d4aaff"><span style="background-color: #d4aaff" /></a>
<a id="#ffaaf7"><span style="background-color: #ffaaf7" /></a>
<br />
<a id="#ff5555"><span style="background-color: #ff5555" /></a>
<a id="#ffbb55"><span style="background-color: #ffbb55" /></a>
<a id="#f1ff55"><span style="background-color: #f1ff55" /></a>
<a id="#55ff66"><span style="background-color: #55ff66" /></a>
<a id="#55ffd6"><span style="background-color: #55ffd6" /></a>
<a id="#5599ff"><span style="background-color: #5599ff" /></a>
<a id="#aa55ff"><span style="background-color: #aa55ff" /></a>
<a id="#ff55ee"><span style="background-color: #ff55ee" /></a>
<br />
<a id="#ff0000"><span style="background-color: #ff0000" /></a>
<a id="#ff9900"><span style="background-color: #ff9900" /></a>
<a id="#ebff00"><span style="background-color: #ebff00" /></a>
<a id="#00ff19"><span style="background-color: #00ff19" /></a>
<a id="#00ffc2"><span style="background-color: #00ffc2" /></a>
<a id="#0066ff"><span style="background-color: #0066ff" /></a>
<a id="#8000ff"><span style="background-color: #8000ff" /></a>
<a id="#ff00e6"><span style="background-color: #ff00e6" /></a>
<br />
<a id="#aa0000"><span style="background-color: #aa0000" /></a>
<a id="#aa6600"><span style="background-color: #aa6600" /></a>
<a id="#9caa00"><span style="background-color: #9caa00" /></a>
<a id="#00aa11"><span style="background-color: #00aa11" /></a>
<a id="#00aa81"><span style="background-color: #00aa81" /></a>
<a id="#0044aa"><span style="background-color: #0044aa" /></a>
<a id="#5500aa"><span style="background-color: #5500aa" /></a>
<a id="#aa0099"><span style="background-color: #aa0099" /></a>
<br />
<a id="#550000"><span style="background-color: #550000" /></a>
<a id="#553300"><span style="background-color: #553300" /></a>
<a id="#4e5500"><span style="background-color: #4e5500" /></a>
<a id="#005508"><span style="background-color: #005508" /></a>
<a id="#005541"><span style="background-color: #005541" /></a>
<a id="#002255"><span style="background-color: #002255" /></a>
<a id="#2b0055"><span style="background-color: #2b0055" /></a>
<a id="#55004d"><span style="background-color: #55004d" /></a>
<br />
<a id="#000000"><span style="background-color: #000000" /></a>
<a id="#242424"><span style="background-color: #242424" /></a>
<a id="#494949"><span style="background-color: #494949" /></a>
<a id="#6d6d6d"><span style="background-color: #6d6d6d" /></a>
<a id="#929292"><span style="background-color: #929292" /></a>
<a id="#b6b6b6"><span style="background-color: #b6b6b6" /></a>
<a id="#dbdbdb"><span style="background-color: #dbdbdb" /></a>
<a id="#ffffff"><span style="background-color: #ffffff" /></a>
<br />
      </p>
      <p>
      <form id="selected-colors-submit" method="get" action="/images">
        <input type="hidden" id="colors" name="colors" value="" />
        <input id="submitButton" type="submit" value="Search" onClick="getImages(); return false;" />
        <input id="submitButton2" type="submit" value="See histogram" onClick="getHistogram(); return false;" />
      </form>
      </p>
      <div id="palette_query"></div>
    </div>
    <div id="images">
      Images that match the colors:
    </div>
  </div>
  <script src="/static/js/ext/jquery-1.8.3.js"></script>
  <script>
    $(document).ready(function() {
      console.log("The palette is:", $('#colors a').map(function(i,el) { return el.id; }));

      getHistogram = function(event) {
        var colors = Object.keys(selected_colors);
        $.get('/query_histogram', data={colors: colors.join(',')},
          success=function(data) {
            //console.log("Received: ", data);
            $('#palette_query').html('<img width="100%" src="data:image/png;base64,'+data+'" />');
          });
      }

      getSimilarImages = function(ind) {
        console.log("here");
        $.getJSON('/similar_to/' + ind,
          success=update_images);
      }

      var update_images = function(json_data) {
        //console.log("Received: ", json_data);
        items = [];
        $.each(json_data, function(i, val) {
          filename = val['filename'].replace('/Volumes/WD Data/', '/static/')
          var a_histogram = '<a href="/image_histogram/' + val['ind'] + '.png">histogram</a>';
          var a_similar = '<a href="#" onclick="getSimilarImages(\'' + val['ind'] + '\'); return false;">similar</a>';
          var img = '<img src="'+filename+'" alt="'+val['distance']+'" width="'+val['width']/4+'" height="'+val['height']/4 + '" />'
          items.push('<div class="result">' + img + '<br />' + a_histogram + ' | ' + a_similar + '</div>');
        });
        console.log(items);
        $('#images').html(items.join(''));
      }

      getImages = function(event) {
        var colors = Object.keys(selected_colors);
        $.getJSON('/images', data={colors: colors.join(',')},
          success=update_images);
      }

      selected_colors = {};

      var toggleSelected = function(event) {
        if (this.getAttribute('class') == 'selected') {
          delete(selected_colors[this.id]);
          this.setAttribute('class', '');
        } else {
          selected_colors[this.id] = 1;
          this.setAttribute('class', 'selected');
        }
        console.log("Selected colors:");
        console.log(selected_colors);
        $('#colors input')[0].value = Object.keys(selected_colors);
      };

      $('a').each(function(i,el) {
        el.onclick = toggleSelected;  
      });

      
    });
  </script>
</body>
</html>
